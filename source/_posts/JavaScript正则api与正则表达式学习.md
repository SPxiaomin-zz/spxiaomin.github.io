---
title: JavaScript正则api与正则表达式学习
date: 2017-08-30 16:57:12
categories: ['技术', '前端技术']
tags: ['javascript']
---

## 正则定义

正则表达式，通俗点讲——

> 正则表达式是用来 **匹配(match)、捕获(capture)** 特定字符串的工具；之后，我们还可以对匹配到、捕获到的对象进行处理，比如 **替换(replace)**。

### 举例如下:

> 如果我们想将 07700 900166 变成 (077)0090-0166 的格式显示，那么我们该怎么做呢？如果有很多这样的工作需要做的话，我们该怎么做呢？手动一个个操作肯定是特别的麻烦。

其实可以通过如下方法进行操作——

```js
let tel = '07700 900166';
let pattern = /(\d{3})(\d{2}) (\d{2})(\d{4})/;
tel.replace(pattern, '($1)$2$3-$4');
```

仔细观察上面的正则表达式pattern，如果翻译成自然语言如下——

1. 用 `\d{3}\d{2} \d{2}\d{4}` **匹配** 电话号码，以便我们能在文档中搜索到所有能够匹配这个正则表达式的字符串；
2. 为了后面能够处理（即，替换），我们分别 **捕获** 了四段字符串: `(\d{3})(\d{2}) (\d{2})(\d{4})`；
3. 然后，我们用 `$1 ... $4` 来表示我们 **捕获到** 的字符串，然后用我们想要的拼接方式去 **替换** **匹配** 到的字符串: `($1)$2$3-$4`；

通过上面的例子，差不多了，这就是 "入门"，后面你要接着研究：

- 各种为了精确匹配所需要的 "符号"；
- 匹配同一个类型的字符串可能有很多种方法；
- 避免错误匹配其实并不容易……

<!-- more -->

## 正则表达式的写法

```js
/hello/g
```

两条斜线的中间是 **匹配模式** ，右边斜线的后面是 **修饰符**。

## 匹配模式

最简单的匹配模式就是直接输入想要匹配的东西，e.g. `/a/`。

但是要注意了，有些符号在特别的地方有特别的意思，e.g. `/./` 可以匹配除了换行符以外的任何东西。如果想要匹配这个符号的话，可以 **escape** 一下它，就是不让它有特别的意思，具体操作就是在符号前面加上反斜杠 `/\./`。

### 字符集(Character Set)

在匹配模式中，我们可以去定义字符集，每个字符集中有可能要匹配的字符，匹配引擎会匹配字符集中的 **任意一个** 字符。

e.g.

```js
/[abc]/
// 匹配 a 或者 b 或者 c。

/[.]/
// 匹配 . ，这个特殊字符在字符集中不需要转义。如果不在字符集中，就匹配除了换行符以外的任何东西。

/[\[\]]/
// 有些字符在字符集中还是需要转义一下。

/[^abc]/
// 否定字符集，就是匹配的东西里面，不能够包含字符集里面出现的东西。
// 上面的例子匹配的东西不会出现 a 或者 b 或者 c。
```

如果字符集里面匹配的东西是全部的小写字母、或者是全部的大写字母、或者是0到9这些数字的话，你不需要把它们都列出到这个字符集里面，可以使用 **字符的范围(Range)**。

```js
/[a-z]/
// 匹配全部的小写字母

/[A-Z]/
// 匹配全部的大写字母

/[0-9]/
// 匹配数字 0-9

/[^0-9]/
// 字符的范围也可以是否定的，匹配的东西里面不会包含 0-9
```

字符的范围还存在有一些简单的写法。

```js
/[\d]/
// 上面的正则表达式等同于 /[0-9]/，是英文单词 digit

/[\D]/
// 上面的正则表达式等同于 /[^0-9]/

/[\w]/
// 上面的正则表达式等同于 /[a-zA-Z0-9_]/，是英文单词 word

/[\W]/
// 上面的正则表达式等同于 /[^a-zA-Z0-9_]/

/[\s]/
// 上面的正则表达式等同于 /[\t\r\n ]/，是英文单词 whitespace

/[\S]/
// 上面的正则表达式等同于 /[^\t\r\n ]/
```

### 群组(Group)

在正则表达式的匹配模式里面，我们可以根据自己的需求将匹配模式划分为一些群组，群组可以

1. 使复杂的匹配模式更容易读懂；
2. 也可以单独为每一个群组应用不同的操作；
3. 而且这个群组里面的东西也可以被记住，稍后我们可以继续利用被记住的内容；

e.g.

```js
匹配如下的文本:

rails
ruby on rails

使用的正则表达式是:
/(ruby on )?rails/g

---

匹配如下的文本:

logo.png
sunrise.jpg
smile.gif

使用的正则表达式是:
/[\w]+\.(png|jpg|gif)/g
上面的正则表达式中使用了一个群组的特性 `或者(即 | )`，表示匹配其中的任何一个都可以。
```

现在来讲讲群组中一个比较重要的特性——**替换(Substitution)**，

默认正则表达式的引擎会记住群组里面匹配的东西，想要得到群组里面都匹配了什么样的东西，我们可以使用 `$n(n表示1-9)`，e.g. `$1` 表示的就是第一个群组里面匹配的东西。还有一个特殊的 `$&` 表示匹配的整个项目。

e.g.

```js
const pattern = /([\w]+)\.(png|jpg|gif)/g;
let text = `
  logo.png
  sunrise.jpg
  smile.gif
`;

text.replace(pattern, '$& 文件名是: $1 扩展名是: $2');
```

群组分两种: 捕获群组(capturing group)和非捕获群组(non capturing group)。

e.g.

```js
/[\w]+\.(png|jpg|gif)/
// 上面的是捕获群组(capturing group)

/[\w]+\.(?:png|jpg|gif)/
// 上面的是非捕获群组(non capturing group)
```

#### 反向引用(BackReferences)

反向引用(BackReferences)就是你可以在匹配模式里面去引用前面用群组匹配记住的东西。

e.g.

```js
有如下的文本:

<h1>hello</h1>
<h2>hello</h2>
<h3>hello</h2>

如果使用如下的正则表达式的话，那么就可以匹配上面的3个标题(包括第3个标签使用错误的标题)。
/<h\d>.+<\/h\d>/g

如果使用如下的正则表达式的话，因为借助了反向引用(BackReferences)，那么第3个标题就不会匹配上了。
/<(h\d)>.+<\/\1>/g
```

#### 环视(Lookaround)

环视(Lookaround)它本身不匹配东西，它的作用有点像一个判断的条件，如果条件通过，就会返回匹配模式里面 **其他部分** 要匹配的东西，它有两个类型:

1. lookahead
2. lookbehind

JavaScript不支持 lookbehind。

lookahead也是分为两种的:

1. 正类型的 lookahead(positive lookahead)；
2. 负类型的 lookahead(negative lookahead)；

e.g.

```js
下面有几个使用了不同单位的数字，我现在只想匹配px单位的数字:
'1pt 2px 3em 6px 90px'

下面的正则表达式(positive lookahead)表示匹配全部的后面带 px 的数字(匹配 2、6、90)，不是 px 的数字不进行匹配。
/\d+(?=px)/g

下面的正则表达式(negative lookahead)表示匹配全部的后面不带 px 的数字(匹配 1、3、9)，是 px 的数字不进行匹配。
/\d+(?!px)/g
注意上面的正则表达式也匹配了90px中的9，因为9后面的是0、也不是px。但是可以通过添加一个(negative lookahead)来取消匹配9，如下:
/\d+(?!px)(?!\d)/g
```

### 边界

#### 行的开始与结束

表示行的开始位置的是 `^`，表示行的结束位置的是 `$`。



###



### 重复(Repetition)

重复可以放在 单独的字符、字符集、群组的后面，影响的是 **紧挨** 在重复前面的项目。

`*`，表示重复出现多次或者不出现。

`+`，表示至少出现一次。

`?`，表示最多只能够出现一次或者不出现。

明确指定重复出现的最小和最大的次数:

`{num}`，表示具体出现多少次。

`{num, }`，表示出现num次或者更多次。

`{min-num, max-num}`，表示出现的次数在什么范围之类，包括边界值。

## 修饰符

`m`，是multi-line的意思，即多行，需要这个修饰符的原因是默认情况下进行匹配的时候是将文本作为一行来进行处理的，添加这个修饰符之后，就会将多行文本当作多行来进行处理。

## References

- [正则表达式极简“入门”](http://lixiaolai.com/2016/07/19/makecs-regular-expression/)
